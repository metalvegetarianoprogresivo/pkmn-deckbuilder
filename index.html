<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Deckbuilder Pro â€¢ PokÃ©mon TCG</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Theme & Variables -->
    <link rel="stylesheet" href="css/variables.css">
    <!-- Base Reset -->
    <link rel="stylesheet" href="css/base.css">
    <!-- Layout -->
    <link rel="stylesheet" href="css/layout.css">
    <!-- Typography -->
    <link rel="stylesheet" href="css/typography.css">
    <!-- Components -->
    <link rel="stylesheet" href="css/components/deck-selector.css">
    <link rel="stylesheet" href="css/components/deck-builder.css">
    <link rel="stylesheet" href="css/components/card-management.css">
    <link rel="stylesheet" href="css/components/sidebar.css">
    <link rel="stylesheet" href="css/components/matchup-optimizer.css">
    <link rel="stylesheet" href="css/components/playtesting.css">
    <link rel="stylesheet" href="css/components/modal.css">
    <link rel="stylesheet" href="css/components/notifications.css">
    <link rel="stylesheet" href="css/components/card-search.css">
    <!-- Animations -->
    <link rel="stylesheet" href="css/animations.css">
    <!-- Responsive Overrides -->
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>âš¡ Universal Deckbuilder Pro</h1>
            <p class="subtitle" id="formatSubtitle">PokÃ©mon TCG &bull; Formato Standard 2026</p>
            <div class="format-selector">
                <button class="format-btn active" id="formatStandard" onclick="onFormatChange('standard')">Standard</button>
                <button class="format-btn" id="formatExpanded" onclick="onFormatChange('expanded')">Expanded</button>
            </div>
            <div class="badge">ğŸ”„ Auto-guardado â€¢ ğŸ² Playtesting â€¢ ğŸ¯ Matchup Optimizer</div>
        </header>

        <div class="deck-selector">
            <h2 class="section-title">ğŸ“‹ Selecciona o Crea tu Deck</h2>
            <div class="deck-grid" id="deckSelector">
                <div class="deck-card" data-deck="custom">
                    <div class="deck-card-icon">â•</div>
                    <div class="deck-card-name">Deck Personalizado</div>
                    <div class="deck-card-meta">Construye desde cero</div>
                </div>
                <div class="deck-card" data-deck="gardevoir">
                    <div class="deck-card-icon">ğŸ”®</div>
                    <div class="deck-card-name">Gardevoir ex</div>
                    <div class="deck-card-meta">Tier 1 â€¢ 16.4% meta</div>
                </div>
                <div class="deck-card" data-deck="dragapult">
                    <div class="deck-card-icon">ğŸ‘»</div>
                    <div class="deck-card-name">Dragapult ex</div>
                    <div class="deck-card-meta">Tier 1 â€¢ 23.4% meta</div>
                </div>
                <div class="deck-card" data-deck="gholdengo">
                    <div class="deck-card-icon">ğŸ’°</div>
                    <div class="deck-card-name">Gholdengo ex</div>
                    <div class="deck-card-meta">Tier 1 â€¢ 18.5% meta</div>
                </div>
                <div class="deck-card" data-deck="charizard">
                    <div class="deck-card-icon">ğŸ”¥</div>
                    <div class="deck-card-name">Charizard ex</div>
                    <div class="deck-card-meta">Tier 1 â€¢ 15.1% meta</div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div>
                <div class="deck-builder">
                    <h2 class="section-title">ğŸƒ Constructor de Deck</h2>

                    <div class="add-card-section">
                        <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--accent);">ğŸ” Buscar y Agregar Carta</h3>
                        <div id="cardSearchContainer">
                            <input
                                type="text"
                                class="form-input"
                                id="cardSearchInput"
                                placeholder="Escribe el nombre de una carta..."
                                autocomplete="off"
                                oninput="onCardSearchInput(event)"
                            >
                            <div id="cardSearchResults" class="card-search-results" style="display: none;"></div>
                        </div>
                        <div id="cardLoadingState" style="display: none; padding: 1rem; text-align: center; color: rgba(255,255,255,0.5); font-size: 0.875rem;">
                            Cargando datos de cartas...
                        </div>
                    </div>

                    <div id="deckBuilder">
                        <div style="text-align: center; padding: 3rem; color: rgba(255,255,255,0.4);">
                            Selecciona un deck o agrega cartas manualmente
                        </div>
                    </div>
                </div>

                <div class="matchup-optimizer">
                    <h2 class="section-title">ğŸ¯ Optimizador de Matchups</h2>
                    <p style="color: rgba(255,255,255,0.6); margin-bottom: 1.5rem; font-size: 0.9rem;">
                        Selecciona o busca cualquier deck del meta para recibir recomendaciones especÃ­ficas
                    </p>

                    <div style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--accent);">ğŸ”— Importar desde Limitless TCG</h3>
                        <p style="font-size: 0.875rem; color: rgba(255,255,255,0.6); margin-bottom: 1rem;">
                            Pega una URL de Limitless (ej: https://limitlesstcg.com/decks/list/12345)
                        </p>
                        <div style="position: relative;">
                            <input
                                type="text"
                                class="form-input"
                                id="limitlessUrlInput"
                                placeholder="https://limitlesstcg.com/decks/list/12345"
                                style="padding-right: 3rem;"
                            >
                            <button
                                onclick="importFromLimitless()"
                                class="btn btn-primary"
                                style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); padding: 0.5rem 1rem; font-size: 0.875rem;">
                                ğŸ“¥
                            </button>
                        </div>
                        <div id="limitlessImportStatus" style="margin-top: 1rem;"></div>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--accent);">ğŸ” Buscar Deck</h3>
                        <div style="position: relative;">
                            <input
                                type="text"
                                class="form-input"
                                id="deckSearchInput"
                                placeholder="Busca cualquier deck (ej: Raging Bolt, Pidgeot, Roaring Moon...)"
                                style="padding-right: 3rem;"
                            >
                            <button
                                onclick="searchDeck()"
                                class="btn btn-primary"
                                style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); padding: 0.5rem 1rem; font-size: 0.875rem;">
                                ğŸ”
                            </button>
                        </div>
                        <div id="deckSearchResults" style="margin-top: 1rem;"></div>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <h3 style="font-size: 1rem; margin-bottom: 0.75rem; color: var(--accent);">âš¡ Decks Populares</h3>
                    </div>

                    <div class="matchup-selector">
                        <button class="matchup-btn" data-matchup="dragapult">ğŸ‘» Dragapult</button>
                        <button class="matchup-btn" data-matchup="gholdengo">ğŸ’° Gholdengo</button>
                        <button class="matchup-btn" data-matchup="charizard">ğŸ”¥ Charizard</button>
                        <button class="matchup-btn" data-matchup="mirror">ğŸª Mirror</button>
                        <button class="matchup-btn" data-matchup="grimmsnarl">ğŸ‘¹ Grimmsnarl</button>
                        <button class="matchup-btn" data-matchup="aggro">âš¡ Meta Agresivo</button>
                        <button class="matchup-btn" data-matchup="ragingbolt">âš¡ Raging Bolt</button>
                        <button class="matchup-btn" data-matchup="roaringmoon">ğŸŒ‘ Roaring Moon</button>
                        <button class="matchup-btn" data-matchup="ancientbox">ğŸ“¦ Ancient Box</button>
                    </div>

                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(59,130,246,0.1); border: 1px solid var(--info); border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span style="font-weight: 600; color: var(--info);">ğŸ“Š Ãšltima ActualizaciÃ³n de Stats</span>
                            <button class="btn btn-secondary" onclick="updateMetaStats()" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                                ğŸ”„ Actualizar Ahora
                            </button>
                        </div>
                        <div style="font-size: 0.875rem; color: rgba(255,255,255,0.7);" id="lastStatsUpdate">
                            Cargando...
                        </div>
                    </div>

                    <div class="recommendations" id="recommendations">
                        <div style="text-align: center; color: rgba(255,255,255,0.4); padding: 2rem;">
                            Selecciona o busca un matchup para ver recomendaciones
                        </div>
                    </div>

                    <div id="selectedMatchupInfo" style="display: none; margin-top: 1.5rem; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem;">
                        <h3 style="font-size: 1rem; color: var(--primary); margin-bottom: 1rem;">ğŸ“ˆ Info del Matchup</h3>
                        <div id="matchupInfoContent"></div>
                    </div>
                </div>

                <div class="playtesting-section">
                    <h2 class="section-title">ğŸ² Sistema de Playtesting</h2>
                    <p style="color: rgba(255,255,255,0.6); margin-bottom: 1.5rem; font-size: 0.9rem;">
                        Prueba la consistencia de tu deck simulando manos iniciales
                    </p>

                    <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary" onclick="drawHand()">
                            ğŸ´ Robar Mano Inicial (7 cartas)
                        </button>
                        <button class="btn btn-secondary" onclick="mulligan()" id="mulliganBtn" disabled>
                            ğŸ”„ Mulligan
                        </button>
                    </div>

                    <div id="handDisplay" style="display: none;">
                        <div style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h3 style="font-size: 1.1rem; color: var(--primary);">Tu Mano</h3>
                                <span id="handCount" style="font-size: 0.9rem; color: rgba(255,255,255,0.5);"></span>
                            </div>
                            <div id="handCards" style="display: grid; gap: 0.5rem; margin-bottom: 1rem;"></div>

                            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                                <h4 style="font-size: 0.9rem; color: var(--accent); margin-bottom: 0.75rem;">AnÃ¡lisis de Mano</h4>
                                <div id="handAnalysis"></div>
                            </div>
                        </div>

                        <div style="margin-top: 1.5rem; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem;">
                            <h3 style="font-size: 1.1rem; color: var(--primary); margin-bottom: 1rem;">EstadÃ­sticas de Testing</h3>
                            <div id="testingStats"></div>
                            <button class="btn btn-secondary" onclick="resetTestingStats()" style="margin-top: 1rem;">
                                ğŸ—‘ï¸ Reiniciar EstadÃ­sticas
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="deck-summary">
                    <div class="deck-count">
                        <div class="deck-count-number" id="totalCards">0</div>
                        <div class="deck-count-label">/ 60 cartas</div>
                    </div>

                    <div class="deck-breakdown">
                        <div class="breakdown-item">
                            <span class="breakdown-label">PokÃ©mon</span>
                            <span class="breakdown-value" id="pokemonCount">0</span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">Trainers</span>
                            <span class="breakdown-value" id="trainerCount">0</span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">Energy</span>
                            <span class="breakdown-value" id="energyCount">0</span>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="exportDeck()">
                            ğŸ“‹ Exportar Decklist
                        </button>
                        <button class="btn btn-secondary" onclick="saveDeck()">
                            ğŸ’¾ Guardar Deck
                        </button>
                        <button class="btn btn-secondary" onclick="loadDeck()">
                            ğŸ“‚ Cargar Deck
                        </button>
                        <button class="btn btn-secondary" onclick="resetDeck()">
                            ğŸ”„ Limpiar Deck
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('exportModal')">Ã—</button>
            <h2 class="section-title">ğŸ“‹ Exportar Decklist</h2>
            <div style="background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; font-family: 'Courier New', monospace; font-size: 0.9rem; white-space: pre-wrap; max-height: 400px; overflow-y: auto; margin: 1rem 0;" id="decklistText"></div>
            <div style="display: flex; gap: 0.75rem;">
                <button class="btn btn-primary" onclick="copyDecklist()" style="flex: 1;">
                    ğŸ“„ Copiar al Portapapeles
                </button>
                <button class="btn btn-secondary" onclick="exportToPDF()" style="flex: 1;">
                    ğŸ–¨ï¸ Descargar PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Save Deck Modal -->
    <div id="saveDeckModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('saveDeckModal')">Ã—</button>
            <h2 class="section-title">ğŸ’¾ Guardar Deck</h2>
            <div class="form-group">
                <label class="form-label">Nombre del Deck</label>
                <input type="text" class="form-input" id="deckNameInput" placeholder="Mi Deck Personalizado">
            </div>
            <button class="btn btn-primary" onclick="confirmSaveDeck()">
                ğŸ’¾ Guardar
            </button>

            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--accent);">Decks Guardados</h3>
                <div id="savedDecksList"></div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Data files -->
    <script src="js/data/preset-decks.js"></script>
    <script src="js/data/meta-decks.js"></script>
    <script src="js/data/matchup-recommendations.js"></script>
    <script src="js/data/extended-matchup-data.js"></script>

    <!-- Shared state -->
    <script src="js/state.js"></script>

    <!-- UI utilities -->
    <script src="js/ui-utilities.js"></script>

    <!-- pdf-lib for PDF export -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>

    <!-- Card search -->
    <script src="js/card-search.js"></script>

    <!-- Core features -->
    <script src="js/deck-management.js"></script>
    <script src="js/export-save.js"></script>
    <script src="js/matchup-optimizer.js"></script>
    <script src="js/meta-stats.js"></script>
    <script src="js/limitless-import.js"></script>
    <script src="js/playtesting.js"></script>
    <script src="js/pdf-export.js"></script>

    <!-- App initialization (must be last) -->
    <script src="js/app.js"></script>
</body>
</html>
